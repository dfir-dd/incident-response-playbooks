<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-playbooks/Ransomware/ransomware-playbook">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Incident Response Playbook - Ransomware Infection | DFIR Wiki</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.it-forensics.wiki/docs/playbooks/Ransomware/ransomware-playbook"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Incident Response Playbook - Ransomware Infection | DFIR Wiki"><meta data-rh="true" name="description" content="Metadata"><meta data-rh="true" property="og:description" content="Metadata"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://www.it-forensics.wiki/docs/playbooks/Ransomware/ransomware-playbook"><link data-rh="true" rel="alternate" href="https://www.it-forensics.wiki/docs/playbooks/Ransomware/ransomware-playbook" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.it-forensics.wiki/docs/playbooks/Ransomware/ransomware-playbook" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="DFIR Wiki RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="DFIR Wiki Atom Feed"><link rel="stylesheet" href="/assets/css/styles.5856423e.css">
<link rel="preload" href="/assets/js/runtime~main.c7c6c551.js" as="script">
<link rel="preload" href="/assets/js/main.befeee4c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="DFIR Wiki Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="DFIR Wiki Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Home</b></a><a class="navbar__item navbar__link" href="/docs/wiki">Wiki</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/playbooks/BEC/business-mail-compromise">Playbooks</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Explie/DFIR-playbooks-and-wiki" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/playbooks/BEC/business-mail-compromise">BEC</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/playbooks/DoS/dos_ddos-playbook">DoS</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/playbooks">Incident Response Playbooks Collection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/docs/playbooks/Ransomware/ransomware-playbook-short">Ransomware</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/playbooks/Ransomware/ransomware-playbook-short">Incident Response Playbook Short - Ransomware Infection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/playbooks/Ransomware/ransomware-playbook">Incident Response Playbook - Ransomware Infection</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/playbooks">Incident Response Playbooks Collection</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Ransomware</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Incident Response Playbook - Ransomware Infection</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Incident Response Playbook - Ransomware Infection</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="metadata">Metadata<a class="hash-link" href="#metadata" title="Direct link to heading">​</a></h2><table><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>ID</strong></td><td>IR-EN-001</td></tr><tr><td><strong>Title</strong></td><td>Incident Response Playbook - Ransomware Infection</td></tr><tr><td><strong>Last Modified</strong></td><td>2021-04-18</td></tr><tr><td><strong>Status</strong></td><td>Draft</td></tr><tr><td><strong>Created</strong></td><td>2020-12-20</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="content">Content<a class="hash-link" href="#content" title="Direct link to heading">​</a></h2><ol><li><a href="#desc">Description</a></li><li><a href="#safe">Safeguards</a></li><li><a href="#prep">Preparation</a></li><li><a href="#dect">Detection / Discovery</a></li><li><a href="#con">Containment / Mitigation</a></li><li><a href="#analysis">Analysis</a></li><li><a href="#rem">Remediation</a></li><li><a href="#rec">Recovery</a></li><li><a href="#post">Post Morten</a></li></ol><h2 class="anchor anchorWithStickyNavbar_LWe7" id="description-">Description <a name="desc"></a><a class="hash-link" href="#description-" title="Direct link to heading">​</a></h2><p>Ransomware attacks can be characterized by infecting large segments of an existing network and encrypting data on server and client systems without the possibility for the legitimate users to get access to this data. The decryption key/mechanism will then be presented to the legitimate user by the attacker in exchange for a more or less reasonable amount of money, most likely in the form of digital currency like bitcoin. The attacker will leave information on the encrypted system on how to contact them for payment and retrieving the decryption methods.<br>
<!-- -->Ransomware became one of the most lucrative cyberattacks in the recent years and is often spread with phishing campaigns against end users or by exploiting unpatched vulnerabilities in external facing systems. Most times the attackers have had deep system access for a long time before the actual encryption of data.<br>
<!-- -->In the event of a ransomware-attack fast response is critical since this could stop ongoing encryption and lateral movement. Most times a hard organization-wide shutdown can&#x27;t be avoided, but the recovery time can highly depend upon the maturity of the incident response program of the organization. <br>
<!-- -->Ransomware events are most likely only the end of an ongoing infiltration of a network. In many cases the attackers will already mapped your network and gathered credentials long before. Even the extortion of data over a long time span is not uncommon nowadays.<br>
<!-- -->Ransomware in particular is still mostly focused on Windows based systems and domains. The recommendations in this playbook aim to be universal but may sometimes be specific to Windows systems.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="safeguards-">Safeguards <a name="safe"></a><a class="hash-link" href="#safeguards-" title="Direct link to heading">​</a></h2><p>These Safeguards are designed to limit the spread and/or impact of a potential ransomware infection. Since ransomware infections often come with wide-spread network compromise the safeguards are also focused on this part.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mature-patch-management">Mature Patch Management<a class="hash-link" href="#mature-patch-management" title="Direct link to heading">​</a></h3><p>When preparing for cyberattacks in general it is highly advised to implement available patches in a safe and fast manner. This way known vulnerabilities can be tackled and the exploitation of these can be stopped.<br>
<!-- -->It is important to keep in mind that not only all available components including network components (routers, switches, etc), servers, endpoints and appliances including security appliances need to be in focus. Also patches need to be tested for the internal use and then applied to the systems in focus within a reasonable time frame depending on the criticality of the issues being fixed.<br>
<!-- -->Components that are not longer supported by the vendor or an active community should not be used or only used with great care and additional and appropriate safeguards. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="endpoint-protection">Endpoint Protection<a class="hash-link" href="#endpoint-protection" title="Direct link to heading">​</a></h3><p>Endpoint protection is about blocking unauthorized changes to a system and to stop the execution of malicious code.<br>
<!-- -->This is normally done with (next-gen) anti-virus software that should always be kept up to date. For systems without support for such software application and execution whitelist could be used.<br>
<!-- -->Endpoint protection need to span on server and client systems and should be configured to alert in a centralized and immediate manner. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-segmentation">Network segmentation<a class="hash-link" href="#network-segmentation" title="Direct link to heading">​</a></h3><p>Network segmentation is about separating the network in multiple network zones that house systems of similar use. A very basic separation could be a three tier network architecture with Client-Zone, Server-Zone and DMZ for Server with external accessibility (internet).<br>
<!-- -->The aim of network segmentation is to limit, control and log the network traffic between the different network zones. When this is properly implemented it could be possible to limit the access from the Client-Zone to the Server-Zone to the necessary ports (Web, Mail, ERP...) and block all other access.<br>
<!-- -->The more granular and restrictive a network segmentation is built the better, but it also gets more troubling to manage. A good configuration management is key to achieve this.<br>
<!-- -->Network segmentation can for example be achieved with multiple firewall-interfaces, other means of VLAN or ACLs on managed switches. When creating a network segmentation the different network segments should be thoroughly planned and involve all available systems (including Virtual Machines and Networks). </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="backup-strategy">Backup Strategy<a class="hash-link" href="#backup-strategy" title="Direct link to heading">​</a></h3><p>Once any malware has successfully rendered data or systems unusable the most common approach to recovery would be replaying the systems or information from a valid backup.<br>
<!-- -->The backup should follow some criteria to ensure usability in the case of an incident:</p><ul><li>Backups should be regularly and stored off-site or at least offline to ensure that they can&#x27;t be reached by a potential attacker that has infiltrated the network</li><li>Backup-Server should not be included in the domain and use dedicated accounts to hinder attackers that have acquired a valid domain admin account. </li><li>Backups should be done on a regular basis according to the criticality of the data to the business. For some data it may be required to only lose some minutes or hours in the event of data loss and for other information days or weeks may be fine. </li><li>Replaying backups should be tested from time to time to ensure that the process is working and that data can be restored within a reasonable time frame. </li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="restrict-administrative-accounts">Restrict Administrative Accounts<a class="hash-link" href="#restrict-administrative-accounts" title="Direct link to heading">​</a></h3><p>Before actually deploying ransomware attackers often try to scope and move through the infected network to increase the potential damage that could be done. For this domain-wide administrative accounts are a lucrative target.<br>
<!-- -->Make sure that all administrators have a low privileged user account for their daily tasks and only switch to their administrative account when absolutely necessary. Administrative accounts should also follow the least-privilege principle and domain administrators should be used even more limited. Another point to remember is to use dedicated accounts for services and not use administrative accounts when possible. Other means are <a href="https://www.microsoft.com/en-us/download/details.aspx?id=46899" target="_blank" rel="noopener noreferrer">Microsoft LAPS</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="security-appliances---firewalls--ids--mail-security">Security Appliances - Firewalls / IDS / Mail Security<a class="hash-link" href="#security-appliances---firewalls--ids--mail-security" title="Direct link to heading">​</a></h3><p>The market offers a huge amount of security appliances for each and every need out there. To protect from ransomware the following are the most crucial:</p><ul><li>Firewall / IDS: Firewalls and IDS have the possibility to block communication to C&amp;C servers and potential downloads of Malware. </li><li>E-Mail Security: Mails including malicious attachments or links are a common tool for attackers. Make sure to have a proper configured spam filter in place and block incoming mails with executable attachments including office documents and content of archive files. Links within mails should be checked as well. </li><li>Managed Endpoint Protection: The endpoint protection solution should be central managed to have a unified view on alerts and the possibility to roll out measures to all devices simultaneously. </li><li>Web-Proxy: Implementing a web-proxy for all connections terminating outside the organizational network can help to monitor and restrict outgoing traffic. Furthermore, Malware which is not proxy-aware could be hindered. For servers internet connectivity should be monitored and restricted even more and a custom proxy could be used.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="endpoint-hardening">Endpoint Hardening<a class="hash-link" href="#endpoint-hardening" title="Direct link to heading">​</a></h3><p>Malware infections often start from one host and later spread through the network. Therefore, the protection of all endpoints is crucial. Make sure to limit access and available services to reduce the attack surface.</p><ul><li>Use endpoint hardening checklists offered by the CIS or other organizations to reduce the attack surface</li><li>Remove old and unpatched systems from the network</li><li>Disable SMBv1, Disable SNMP version 1 and 2, disable Windows script host, disable office macros or restrict them further if disabling is not an option</li><li>Restrict internet access where possible. Server should not have internet access in general. If they need to reach certain services only enable FW rules or access lists. Clients in general require internet access but mostly only for a few services/protocols (Mail, HTTP). Other services can often be restricted. (Like FTP, SSH, RPC...)</li><li>Also make sure to restrict communication within the domain. Not each workstation needs to reach everything in the domain and vice versa.</li><li>Disable USB storage if possible.</li><li>Enable Windows <a href="https://docs.microsoft.com/en-us/windows/security/threat-protection/windows-defender-application-control/applocker/applocker-overview" target="_blank" rel="noopener noreferrer">Applocker</a> or other whitelisting technology.</li><li>Enable Microsoft Defender <a href="https://docs.microsoft.com/en-us/microsoft-365/security/defender-endpoint/controlled-folders?view=o365-worldwide" target="_blank" rel="noopener noreferrer">controller folder access</a>.</li><li>Enable <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon" target="_blank" rel="noopener noreferrer">Sysmon</a> logging.</li><li>Disable Windows Scripting Host (WSH).</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vulnerability-management">Vulnerability Management<a class="hash-link" href="#vulnerability-management" title="Direct link to heading">​</a></h3><p>Define and implement a mature vulnerability management process to constantly keep track of vulnerabilities in your network and remediate them accordingly. Known vendors are Tenable, Qualys etc.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="restrict-access-to-management-interfaces">Restrict access to Management Interfaces<a class="hash-link" href="#restrict-access-to-management-interfaces" title="Direct link to heading">​</a></h3><p>Management interfaces of all kind are prone to being abused by an attacker. Make sure to properly secure them (MFA) or disable external access all together.<br>
<!-- -->Common management interfaces exists for Web Apps, Network components like firewalls and switches and appliances as well as IoT devices.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="awareness-trainings">Awareness Trainings<a class="hash-link" href="#awareness-trainings" title="Direct link to heading">​</a></h3><p>Uses are still the number one vulnerability in every infrastructure no matter the size. To tackle this make sure to not give them to many right and properly train your users to identify malicious activity and properly react and notify to it.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="vpn">VPN<a class="hash-link" href="#vpn" title="Direct link to heading">​</a></h3><p>VPN when not properly secured offer an easy way for an attacker to infiltrate a network. Make sure to protect your VPN with current encryption methods, client-certificates and multi-factor authentication. Make as many services available through the VPN but not the internet to reduce your external perimeter. For Site2Site VPNs with third parties make sure that they only reach the needed targets and always configure with least privileges principle in mind. <br>
<!-- -->Also make sure to properly monitor and log authentication requests to find anomalies. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="preparation-">Preparation <a name="prep"></a><a class="hash-link" href="#preparation-" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-orchestration-tools">Network orchestration tools<a class="hash-link" href="#network-orchestration-tools" title="Direct link to heading">​</a></h3><p>When dealing with ransomware attacks it is helpful to have a hardware and software inventory as well as the possibility to roll out patches and software, make configuration changes and populate software to systems in the network. For example to schedule certain scans or patch for known vulnerabilities.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ioc-scans-for-network-traffic-and-hosts">IoC scans for network traffic and hosts<a class="hash-link" href="#ioc-scans-for-network-traffic-and-hosts" title="Direct link to heading">​</a></h3><p>During the analysis of ransomware certain indicators of compromise will be found. It is crucial to be able to scan the network traffic (netflow, IDS, Firewall) as well as the hosts (THOR, YARA) for these indicators in a central manner.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-segmentation-and-quarantine">Network segmentation and quarantine<a class="hash-link" href="#network-segmentation-and-quarantine" title="Direct link to heading">​</a></h3><p>A strict network segmentation enables the possibility to isolate and quarantine certain systems and segments that seem to be infected without having to pull the plug. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="central-log-management">Central Log management<a class="hash-link" href="#central-log-management" title="Direct link to heading">​</a></h3><p>For analysis of incidents log data is key. Since attackers do know this as well they often seek to destroy or manipulate log data. A central, secured log service can help for later investigation of the incident, impact and attack methods used. Best utilized is a central log service when all log data is synchronized with a central timeserver and uses a common log format. Central log server should be properly secured to keep attackers at bay and store the data for some time in the past to enable thorough investigations (30 - 90 days considering priority). 
Logs should be collected for network data (at least netflow), for internal traffic as well as external traffic. DNS requests. System security logs. Authentication logs. Service logs for important services.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="enhance-your-logging">Enhance your logging<a class="hash-link" href="#enhance-your-logging" title="Direct link to heading">​</a></h3><p>There are different ways to further increase logging to identify access to critical data. For example with the Windows last access timestamp that can be enabled for certain folders and file shares or WMI Trace Logs. Comparable means are available for other systems as well. Also make sure to properly size your log files to stop them from fast log rotating. Windows and Linux system log sizes can be adjusted. (This is crucial for important server systems like file shares, management systems, domain controller etc. and the central system and security log files)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-and-business-knowledge">Network and business knowledge<a class="hash-link" href="#network-and-business-knowledge" title="Direct link to heading">​</a></h3><p>You will need a in depth knowledge about your network and you core business processes in order to remediate in the proper priority and reasonable timeframe.<br>
<!-- -->This includes but is not limited to:</p><ul><li>Used OS and software</li><li>Used Domain-Policies</li><li>Logging mechanisms</li><li>Prioritized list of business processes</li><li>Prioritized lists of users</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="mock-incidents">Mock Incidents<a class="hash-link" href="#mock-incidents" title="Direct link to heading">​</a></h3><p>Training the worst case is crucial for a timely reaction in this certain event. Make sure to properly train all the steps that go into remediating security incidents from time to time.<br>
<!-- -->This involves testing back-ups and how fast you can roll back as well as organizational process like hire additional experts.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ransom-payment-policy">Ransom payment policy<a class="hash-link" href="#ransom-payment-policy" title="Direct link to heading">​</a></h3><p>As an organization you should have a policy if at all and under which circumstances you are willing to negotiate a possible ransom payment. As always I do condemn paying the ransom in any case, but I do also understand that this is not always an option.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="upfront-decisions">Upfront decisions<a class="hash-link" href="#upfront-decisions" title="Direct link to heading">​</a></h3><p>There are certain decision that should be made upfront including but not limited to:</p><ul><li>When to pull the plug</li><li>Critical business path and involved systems</li><li>Who can make which decisions</li><li>3rd party support at hand for forensic analysis, IT support (rebuilding systems and networks), public communication,  legal advice... </li><li>If and when to pay a ransom</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-and-service-desk-awareness">User and service desk awareness<a class="hash-link" href="#user-and-service-desk-awareness" title="Direct link to heading">​</a></h3><p>Ransomware impact often get to know first by the end users of systems and services therefore it is important that these users and the service desk (first level support) where the users will raise their problems are properly trained to detect the signs of system compromise and ransomware infections and that they know where and how to escalate these issues to enable fast first response.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="insurance">Insurance<a class="hash-link" href="#insurance" title="Direct link to heading">​</a></h3><p>Since cyber incidents as any other incidents can cause serious damage and inflict unknown costs it is possible to insure the residual risk for cyber incidents. It is not always the best option, but it should at least be known that this is a possibility.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="detection--discovery-">Detection / Discovery <a name="dect"></a><a class="hash-link" href="#detection--discovery-" title="Direct link to heading">​</a></h2><p>Detecting Ransomware is normally quite easy since it is a &quot;loud&quot; attack event in its nature. Ransomware events that were successful can most times be identified by:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ransomware-notes">Ransomware notes<a class="hash-link" href="#ransomware-notes" title="Direct link to heading">​</a></h3><p>Ransomware notes often come in the form of human-readable text files that include information about what happened (encryption) and how to retrieve the original files (payment). Sometimes also screen backgrounds are changed or new programs are deployed that open up automatically and inform about the ransom.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encrypted-files">Encrypted Files<a class="hash-link" href="#encrypted-files" title="Direct link to heading">​</a></h3><p>When successful ransomware attacks will encrypt many files on the infected systems, overwriting the original files. The encryption focuses on data that has value speaking of databases and documents and not log files or executables. The encrypted files can be identified by their new file ending which is most likely cryptic or because the file can&#x27;t be opened and read as normal as before.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unusual-high-load">Unusual high load<a class="hash-link" href="#unusual-high-load" title="Direct link to heading">​</a></h3><p>When the encryption is ongoing the system may see unusual high load. For example with high CPU usage, high Disk(I/O) usage and unusual many file and folder access calls. This can be monitored through many tools and should be investigated further.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="anti-virus-or-ids-events">Anti-virus or IDS Events<a class="hash-link" href="#anti-virus-or-ids-events" title="Direct link to heading">​</a></h3><p>Events of your security appliances should be thoroughly monitored and investigated. For ransomware events look out for privilege escalation attempts, widespread use of one account through many systems, unusual administrative account usage (shell usage, WMI, etc.) and blocked execution of unknown software that occurs on multiple systems. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="beacon-file-monitoring">Beacon file monitoring <a class="hash-link" href="#beacon-file-monitoring" title="Direct link to heading">​</a></h3><p>Many security appliances nowadays use custom deployed beacon files to watch whether they get accessed or changed later on and alert in this case. When such an event occurred on a single system make sure to investigate the access and see whether this was unintentional user behaviour or something malicious. When such alerting occurs in a short time span on multiple systems this is nearly always a good indicator for a ransomware infection.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="user-reports">User reports<a class="hash-link" href="#user-reports" title="Direct link to heading">​</a></h3><p>In most cases the users will be the first to notice the impact of a successful ransomware infection. In these cases some systems may not be working as expected or information can no longer be retrieved. When such user reports come in make sure to investigate them and look for other indicators of ransomware. Therefore, it is important to properly train your first level support desk to handle these reports and first-hand investigation in a safe and timely manner.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="network-traffic">Network traffic<a class="hash-link" href="#network-traffic" title="Direct link to heading">​</a></h3><p>When searching for hints to ransomware infection one normally does not have to rely on network traffic since other indicators may be more present. When searching through traffic logs make sure to watch out for unusual DNS Traffic, direct connections to IP-addresses and not domains, unusual protocols and unusual ports as well as combinations of those. Also look out for internal connections originating from few systems to many others and clarify that these do not present a &quot;normal&quot; behaviour like administrative tasks.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="abused-accounts">Abused Accounts<a class="hash-link" href="#abused-accounts" title="Direct link to heading">​</a></h3><p>Admin and user accounts running havoc and being utilized at unusual times or for unusual action can be a sign of malicious activity in general.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unusual-executables-or-processes-that-launch-on-boot">Unusual Executables or Processes (that launch on boot)<a class="hash-link" href="#unusual-executables-or-processes-that-launch-on-boot" title="Direct link to heading">​</a></h3><p>Executables files that pop up on one or more systems without any reasonable explanation as well as new auto-start entries are usually a bad sign.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation">Documentation<a class="hash-link" href="#documentation" title="Direct link to heading">​</a></h3><p>Starting with the discovery phase it is crucial to create and continue a documentation of the planned and carried out actions as well as additional information and sightings belonging to the case. This way it is easily possible to on-board new members to the case, hand over to third parties and will be from great value for potential later involvement of authorities. Furthermore, this way improvement to the incident response processes and infrastructure can be easily derived later on.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="containment--mitigation-">Containment / Mitigation <a name="con"></a><a class="hash-link" href="#containment--mitigation-" title="Direct link to heading">​</a></h2><p>Containment of a ransomware threat should better be done too broad then to little. Include at least all systems that show symptoms and incorporate all possible information you can get from the analysis steps.
When containing the infection it can sometime be more effective to focus on the systems that are not infected or show no signs of infection and make sure that they can&#x27;t get infected later on.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reset-or-lock-compromised-accounts">Reset or lock compromised accounts<a class="hash-link" href="#reset-or-lock-compromised-accounts" title="Direct link to heading">​</a></h3><p>All accounts that were compromised should be locked and reset before any further use. Make sure to also change the password for all services using the same credentials. Check for abuse of the accounts that are infected.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-uninfected-systems">Secure uninfected systems<a class="hash-link" href="#secure-uninfected-systems" title="Direct link to heading">​</a></h3><p>For wide-reaching infections it is often more usable to first ignore the obviously infected systems and make sure to secure the non-infected systems. This can be done by starting controlled shutdowns or properly separate the systems. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="encapsulation-of-infected-subnetssystems">Encapsulation of infected subnets/systems<a class="hash-link" href="#encapsulation-of-infected-subnetssystems" title="Direct link to heading">​</a></h3><p>When your network is structured in multiple subnets it may be possible to stop the ongoing infection with disconnecting all subnets that show signs of infections. All other systems still have to be monitored very closely to watch out for other corrupted systems. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pausing-of-infected-or-potential-infected-vms">Pausing of infected or potential infected VMs<a class="hash-link" href="#pausing-of-infected-or-potential-infected-vms" title="Direct link to heading">​</a></h3><p>Pause (not shutdown) Virtual Machines that show signs of an active infection. This way they may be analysed later without potential data loss.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="shutdown-of-infected-or-potential-infected-systems-non-vm">Shutdown of infected or potential infected Systems (Non-VM)<a class="hash-link" href="#shutdown-of-infected-or-potential-infected-systems-non-vm" title="Direct link to heading">​</a></h3><p>Shutdown all systems that show signs of infection and are not virtualized. When this is no option at least disconnect the network.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="disconnect-shared-drives">Disconnect shared drives<a class="hash-link" href="#disconnect-shared-drives" title="Direct link to heading">​</a></h3><p>Normally when isolating systems that includes all network traffic so shared drives should be already among them but since file shares normally do hold precious data one can not stress that enough!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="restrict-or-disable-internet-connection-for-infected-segments">Restrict or disable internet connection for infected segments<a class="hash-link" href="#restrict-or-disable-internet-connection-for-infected-segments" title="Direct link to heading">​</a></h3><p>For infected systems or network segments the internet connection should be disabled and also internal connections should be strongly restricted to ensure no further spreading is possible and all C&amp;C connectivity is blocked.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-back-up-availability">Check Back-Up availability<a class="hash-link" href="#check-back-up-availability" title="Direct link to heading">​</a></h3><p>Make sure to check whether back-ups were affected by destruction, manipulation or encryption. Take proper care to secure them and make sure that they will stay unaffected. In the simplest case by taking the back-up off-network.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="secure-needed-data">Secure needed data<a class="hash-link" href="#secure-needed-data" title="Direct link to heading">​</a></h3><p>Make sure to first care about data that may be overwritten due to log rotation or other means. Export this data to have it available for the analysis. For example logs of firewalls and IDS systems as well as server and clients that can&#x27;t be paused or shut down are prone to lose data due to overwriting mechanism. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="communication-internal-and-external">Communication internal and external<a class="hash-link" href="#communication-internal-and-external" title="Direct link to heading">​</a></h3><p>Prepare your communication for employees and external sources because you will likely be running a limited network for the next couple of days or even weeks. External communication is also crucial when PII is suspect to be disclosed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-1">Documentation<a class="hash-link" href="#documentation-1" title="Direct link to heading">​</a></h3><p>Keep in mind to document all actions that were done. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-">Analysis <a name="analysis"></a><a class="hash-link" href="#analysis-" title="Direct link to heading">​</a></h2><p>Analysis of such incidents should be conducted by a properly trained person. This documentation can only help to provide the most basics steps and give you some kind of guideline.<br>
<!-- -->For analysis steps always make sure to not tamper with the information. Make copies of the original data and work with them. Only mount file systems as read-only to not change any data. Take extra care with live malware and commands/scripts to not infected clean systems.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determine-the-ransomwaremalware-type">Determine the Ransomware/Malware type<a class="hash-link" href="#determine-the-ransomwaremalware-type" title="Direct link to heading">​</a></h3><p>Ransomware is often reused by their actors in multiple attacks against different targets. Thus allowing to define certain characteristics that are often similar or even the same between different attacks using the same ransomware-software. This information can help through the whole response process. It is therefore crucial to identify the ransomware family. Besides information about the attack some ransomware families are known to have used weak encryption methods or faulty implementation thus allowing for decryption of the encrypted data.<br>
<!-- -->There are several ways to determine the ransomware type. In most events it is sufficient to read through the notes that are dropped by the attacker providing additional information about the attack on how to retrieve the data/make the payment. These notes are either placed in every folder/ the desktop/ opened by itself or visible as a changed background picture.
Another indicator may be the file ending of the encrypted files or the encrypted file itself (metadata etc...).<br>
<!-- -->Use normal search engines to identify the ransomware family with the above information or use specialized web services like <a href="https://www.nomoreransom.org/crypto-sheriff.php" target="_blank" rel="noopener noreferrer">NoMoreRansom</a> or <a href="https://id-ransomware.malwarehunterteam.com/" target="_blank" rel="noopener noreferrer">ID-Ransomware</a> that will take an encrypted file and/or the ransomware note to automatically determine the ransomware type. In many cases this is sufficient. If not you may seek help from professional security providers or ask in the <a href="https://www.bleepingcomputer.com/forums/f/239/ransomware-help-tech-support/" target="_blank" rel="noopener noreferrer">BleepingComputer forum</a>.
When you have identified the ransomware family search for already conducted analysis reports and gather the following information:</p><ul><li>Decryption chances: Is it possible to decrypt the encrypted files without paying the ransom? What experiences have others made after paying the ransom? Are all files targeted? Is the whole file encrypted or only some information (may help with large files like databases which could be recovered if only the metadata was destroyed) ?</li><li>Indicators of compromise: What are common attack, persistence and lateral movement vectors used by the actors? Other indicators like network traffic to specific domains etc. . This information can be used to scan and locate and remediate the infection. Where are the executable dropped by the ransomware, are they still there? If so make sure to leave them in place for later analysis.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determine-the-attack-vector">Determine the attack vector<a class="hash-link" href="#determine-the-attack-vector" title="Direct link to heading">​</a></h3><p>Try to track down the root of the initial infection through time-lining of infected systems or by statements from employees. Where this is not feasible try to track down the most potential targets and work from there. Common root causes can be:</p><ul><li>Phishing Mails: Mails with malicious links or files attached are one of the most common infection paths. These link often lead to faked pages that try to trick the user into downloading files or entering credentials that will then later be exploited. E.g. VPN Logins. With this you have to rely heavily on user feedback. Make sure to create a culture that supports employees to admin errors otherwise they will not call out to you in respect of the feared consequences.</li><li>Attached removable media: Untrained users may attach non-trusted media or devices to their company systems. This way unknown and untrusted software could be placed or executed on these systems.</li><li>Vulnerable systems: Unpatched, unmanaged or obsolete system pose a great threat and are often targeted by attackers. In focus lay system that are externally facing but this is not limited to them. Every vulnerable system can help the attackers to strengthen their foothold in the infrastructure. System that are often available to attackers and are prone to being exploited are for example VPN gateways, Firewalls, Mail server, Web- and application server, PBX systems, FTP server.</li><li>Unusual events in general: Make sure to also review all unusual events that occurred in the last several weeks or even months and check for possible connections. For example loss of hardware, burglaries, technology partners that were attacked or even employees that were terminated in bad standing can have a context to a malware outbreak way after.
The target is to identify the system where the attacker started to iterate the network and gather more information since this will most likely be a system infected very early and close to the attack vector itself if it is not the system posing the attack vector.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="gather-information-about-the-malware-that-was-deployed-and-their-damage-potential">Gather information about the malware that was deployed and their damage potential<a class="hash-link" href="#gather-information-about-the-malware-that-was-deployed-and-their-damage-potential" title="Direct link to heading">​</a></h3><p>Try to get a sample from the active malware that was executed on the environment. Normally ransomware comes with various droppers, exploit kits, scanners and so on resulting in multiple binaries that we need to search for. Use the collected IoC from the ransomware family and search for executables in known locations. Other possibilities include reviewing last run software (prefetch, amcache/shimcache), system event logs, MFT timelines, auto start mechanisms (registry auto start keys, autostart folder, tasks, services, CRON jobs, bashrc etc…) and malware search tools like THOR, Rootkit Removal Tools, multiple antivirus suites to identify unknown malware binaries.<br>
<!-- -->Identified malware can be analysed through sandboxes or static analysis measure up to reverse engineering to find out what functionalities the malware had and what other damage may be done which is currently unknown.<br>
<!-- -->Through this means it may be possible to identify system which may not be corrupted or at least not by automatic measures.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determine-the-scope-of-the-attack">Determine the scope of the attack<a class="hash-link" href="#determine-the-scope-of-the-attack" title="Direct link to heading">​</a></h3><p>To properly plan the extent of later recovery and eradication measures it is crucial to identify the scope of the attack. What system were infected for sure, what system may be infected and which system may be untouched. This has to be properly checked of course.<br>
<!-- -->Use automatic tools to scan the network for all identified IoCs. This can include checking for network traffic in central network components (firewalls, proxies, core switches). Other means are YARA or THOR rules or additional policies for the endpoint protection with the help of the vendor.<br>
<!-- -->Another important point is to identify affected data. This should focus on data that is damaged in the form of encryption but also data that may be copied without permission from the systems. When there is no DRM or Data Loss prevention in place this can be a very hard task to identify. Try to scope out the amount of outgoing traffic to known domains of the attackers and from which system it was sent. Starting with this search for manual executed commands or database queries. If you can&#x27;t further pivot the data that may be corrupted on a system you must assume the worst case. Identify stolen data is crucial since the attacker will try to threaten you with realizing stolen data. This is almost always a very hard task to do and depends heavily on the system to identify such actions in the first place.<br>
<!-- -->Also make sure to check for exposure/disclosure of PII since then you not only have to properly inform all affected persons and the data protection officers but also have to make sure what other measures were in place to secure PII and if they may be breached as well. (Encryption in rest etc.)<br>
<!-- -->Check whether backups were affected and how far the traces of the attack go to identify which backups may be safe.
Determine which services are effected and which may be used with limited impact.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="timeline">Timeline<a class="hash-link" href="#timeline" title="Direct link to heading">​</a></h3><p>Creating a timeline of events will help you take different information in a reasonable structure and will enable new clues that evolve through the interaction of different information. Make sure to check that the time zones of different events match your timeline.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="check-for-backdoors">Check for backdoors<a class="hash-link" href="#check-for-backdoors" title="Direct link to heading">​</a></h3><p>The attackers will most likely try to preserve a foothold in your infrastructure through so-called backdoors. These have to persist on the file system and need a way of communication with the attacker. Monitor for traffic to unusual domains or IPs from systems that normally don&#x27;t have active network activity. Restrict all systems to only the network traffic that is needed for the services on the system. Also check for beacon traffic occurring in certain patterns. <br>
<!-- -->Another way is the use of backdoor or rootkit removal tools like Kaspersky <a href="https://usa.kaspersky.com/downloads/tdsskiller" target="_blank" rel="noopener noreferrer">TDSSKiller</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-2">Documentation<a class="hash-link" href="#documentation-2" title="Direct link to heading">​</a></h3><p> Keep in mind to document all actions that you conducted as well as the results. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="remediation-">Remediation <a name="rem"></a><a class="hash-link" href="#remediation-" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="close-the-attack-vector">Close the attack vector<a class="hash-link" href="#close-the-attack-vector" title="Direct link to heading">​</a></h3><p>It is crucial to identify the attack vector and lateral movement techniques used and properly close them. Otherwise, the same vulnerabilities could be exploited again by the same or other attackers in very short time. When the attack vector could not be identified properly you have to make sure to properly increase overall it-security to enhance monitoring and implement safeguards for all identified techniques the attackers have used or abused.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="patching">Patching<a class="hash-link" href="#patching" title="Direct link to heading">​</a></h3><p>Make sure to patch all your systems including networking devices. Start with former infected systems and those which are on the network perimeter. Then go for security appliances and servers, prioritizing by with business criticality. Afterwards care for clients and everything else.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ioc-search-the-whole-infrastructure">IoC search the whole infrastructure<a class="hash-link" href="#ioc-search-the-whole-infrastructure" title="Direct link to heading">​</a></h3><p>Use the identified IoC&#x27;s and scan your whole infrastructure to identify infected or otherwise compromised systems.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="remove-backdoors-and-other-malware-from-the-systems">Remove backdoors and other malware from the systems<a class="hash-link" href="#remove-backdoors-and-other-malware-from-the-systems" title="Direct link to heading">​</a></h3><p>Use the knowledge about the identified attack methods to clean all systems from backdoors/Trojans that might AutoStart and other executable programs that might get executed by untrained personal.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adjust-firewall--ids--av">Adjust Firewall / IDS / AV<a class="hash-link" href="#adjust-firewall--ids--av" title="Direct link to heading">​</a></h3><p>Adjust your security appliances like firewalls, IDS/IPS and endpoint protection systems to identify the known indicators from the attack and be prepared for new outbreaks of malware beacons that were missed beforehand.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-3">Documentation<a class="hash-link" href="#documentation-3" title="Direct link to heading">​</a></h3><p>Keep in mind to document all actions that were done. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recovery-">Recovery <a name="rec"></a><a class="hash-link" href="#recovery-" title="Direct link to heading">​</a></h2><p>Recovery can be started after the remediation efforts are done or beforehand in a completely new network zone that has initially no ties to the infected network. When needed the infected systems can be continued to be used with great care and connectivity to other systems should be limited to known good services and protocols. (For example with firewall rules)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rebuild-or-cleanse-infected-systems-in-a-new-network-zone">Rebuild or cleanse infected systems in a new network zone<a class="hash-link" href="#rebuild-or-cleanse-infected-systems-in-a-new-network-zone" title="Direct link to heading">​</a></h3><p>Infected systems should be rebuilt from scratch with hardened blueprints in a new network zone without or with very limited connectivity to the infected network. When an analysis of the incident was conducted it sometimes can be possible to cleanse infected systems with known IOCs and not rebuilding them from scratch. But in most cases this will pose a great residual risk.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rebuild-the-domain">Rebuild the domain<a class="hash-link" href="#rebuild-the-domain" title="Direct link to heading">​</a></h3><p>When domain controller and or domain administrative account were compromised it is often necessary to build a new domain (tree) since trying to clean up the old domain can be tricky. If you want to do this, check for backup accounts, reset all accounts, reset the golden ticket as described by Microsoft (when windows AD) check group policies and even then you may have forgotten something.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="recover-data-from-known-good-backups">Recover data from known good backups<a class="hash-link" href="#recover-data-from-known-good-backups" title="Direct link to heading">​</a></h3><p>After the systems have been rebuilt, the data from the last known good backup can be restored if available. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pay-the-ransom-if-no-other-way-can-be-found">Pay the ransom (if no other way can be found)<a class="hash-link" href="#pay-the-ransom-if-no-other-way-can-be-found" title="Direct link to heading">​</a></h3><p>Decide whether to pay the ransom or not. There are known trusted services to support with this endeavour if necessary.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="address-collateral-damage">Address collateral damage<a class="hash-link" href="#address-collateral-damage" title="Direct link to heading">​</a></h3><p>Ransomware and measures to control the incident can result in collateral damage to systems, production and personal. Make sure to properly address these parts as well and make use of the created documentation to identify them.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="ensure-that-network-traffic-is-back-to-normal">Ensure that network traffic is back to normal<a class="hash-link" href="#ensure-that-network-traffic-is-back-to-normal" title="Direct link to heading">​</a></h3><p>After a major incident you will spin up system by system and service by service. During this time and afterwards it could be a good invest to monitor the network traffic and search for anything that does not look like it belongs there. Heavy inter-machine communication. External traffic from internal system using unusual protocols, etc. . This becomes even more crucial when you want to include some &quot;old&quot; systems and not rebuild literally everything.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="documentation-4">Documentation<a class="hash-link" href="#documentation-4" title="Direct link to heading">​</a></h3><p>As always keep in mind to document all actions that were done. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="post-morten-">Post Morten <a name="post"></a><a class="hash-link" href="#post-morten-" title="Direct link to heading">​</a></h2><p>Review your created documentation and conduct lessons learned sessions to improve the overall process of incident handling as well as overall IT security.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="review-the-incident-response-process">Review the incident response process<a class="hash-link" href="#review-the-incident-response-process" title="Direct link to heading">​</a></h3><p>Enhance the response process for later incidents by collecting what went good and what not. Identify steps that needed more preparation and use the advice that was given by any involved parties throughout the response. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="discuss-security-enhancements">Discuss security enhancements<a class="hash-link" href="#discuss-security-enhancements" title="Direct link to heading">​</a></h3><p>During the investigation of an incident many measures and potentials for enhancement will come to light. Keep track of them through the incident handling process and discuss them afterwards with deciders and colleagues to see which will fit your organization best and provide the most use for your overall IT-Security.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="conduct-external-reviews">Conduct external reviews<a class="hash-link" href="#conduct-external-reviews" title="Direct link to heading">​</a></h3><p>To help further harden your infrastructure think about external review opportunities like penetration tests or security audits.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="determine-incident-cost">Determine Incident cost<a class="hash-link" href="#determine-incident-cost" title="Direct link to heading">​</a></h3><p>Regarding insurance but also regarding your own controlling it will be necessary to communicate a total number of efforts and damages done because of the security incident. This includes potential losses because your systems were halted and such.<br>
<!-- -->But this is also crucial for you ongoing risk analysis and cost-benefit analysis regarding security invests in the future.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/Explie/DFIR-playbooks-and-wiki/blob/main/docs/playbooks/Ransomware/ransomware-playbook.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/playbooks/Ransomware/ransomware-playbook-short"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Incident Response Playbook Short - Ransomware Infection</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/playbooks"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Incident Response Playbooks Collection</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#metadata" class="table-of-contents__link toc-highlight">Metadata</a></li><li><a href="#content" class="table-of-contents__link toc-highlight">Content</a></li><li><a href="#description-" class="table-of-contents__link toc-highlight">Description <a name="desc"></a></a></li><li><a href="#safeguards-" class="table-of-contents__link toc-highlight">Safeguards <a name="safe"></a></a><ul><li><a href="#mature-patch-management" class="table-of-contents__link toc-highlight">Mature Patch Management</a></li><li><a href="#endpoint-protection" class="table-of-contents__link toc-highlight">Endpoint Protection</a></li><li><a href="#network-segmentation" class="table-of-contents__link toc-highlight">Network segmentation</a></li><li><a href="#backup-strategy" class="table-of-contents__link toc-highlight">Backup Strategy</a></li><li><a href="#restrict-administrative-accounts" class="table-of-contents__link toc-highlight">Restrict Administrative Accounts</a></li><li><a href="#security-appliances---firewalls--ids--mail-security" class="table-of-contents__link toc-highlight">Security Appliances - Firewalls / IDS / Mail Security</a></li><li><a href="#endpoint-hardening" class="table-of-contents__link toc-highlight">Endpoint Hardening</a></li><li><a href="#vulnerability-management" class="table-of-contents__link toc-highlight">Vulnerability Management</a></li><li><a href="#restrict-access-to-management-interfaces" class="table-of-contents__link toc-highlight">Restrict access to Management Interfaces</a></li><li><a href="#awareness-trainings" class="table-of-contents__link toc-highlight">Awareness Trainings</a></li><li><a href="#vpn" class="table-of-contents__link toc-highlight">VPN</a></li></ul></li><li><a href="#preparation-" class="table-of-contents__link toc-highlight">Preparation <a name="prep"></a></a><ul><li><a href="#network-orchestration-tools" class="table-of-contents__link toc-highlight">Network orchestration tools</a></li><li><a href="#ioc-scans-for-network-traffic-and-hosts" class="table-of-contents__link toc-highlight">IoC scans for network traffic and hosts</a></li><li><a href="#network-segmentation-and-quarantine" class="table-of-contents__link toc-highlight">Network segmentation and quarantine</a></li><li><a href="#central-log-management" class="table-of-contents__link toc-highlight">Central Log management</a></li><li><a href="#enhance-your-logging" class="table-of-contents__link toc-highlight">Enhance your logging</a></li><li><a href="#network-and-business-knowledge" class="table-of-contents__link toc-highlight">Network and business knowledge</a></li><li><a href="#mock-incidents" class="table-of-contents__link toc-highlight">Mock Incidents</a></li><li><a href="#ransom-payment-policy" class="table-of-contents__link toc-highlight">Ransom payment policy</a></li><li><a href="#upfront-decisions" class="table-of-contents__link toc-highlight">Upfront decisions</a></li><li><a href="#user-and-service-desk-awareness" class="table-of-contents__link toc-highlight">User and service desk awareness</a></li><li><a href="#insurance" class="table-of-contents__link toc-highlight">Insurance</a></li></ul></li><li><a href="#detection--discovery-" class="table-of-contents__link toc-highlight">Detection / Discovery <a name="dect"></a></a><ul><li><a href="#ransomware-notes" class="table-of-contents__link toc-highlight">Ransomware notes</a></li><li><a href="#encrypted-files" class="table-of-contents__link toc-highlight">Encrypted Files</a></li><li><a href="#unusual-high-load" class="table-of-contents__link toc-highlight">Unusual high load</a></li><li><a href="#anti-virus-or-ids-events" class="table-of-contents__link toc-highlight">Anti-virus or IDS Events</a></li><li><a href="#beacon-file-monitoring" class="table-of-contents__link toc-highlight">Beacon file monitoring </a></li><li><a href="#user-reports" class="table-of-contents__link toc-highlight">User reports</a></li><li><a href="#network-traffic" class="table-of-contents__link toc-highlight">Network traffic</a></li><li><a href="#abused-accounts" class="table-of-contents__link toc-highlight">Abused Accounts</a></li><li><a href="#unusual-executables-or-processes-that-launch-on-boot" class="table-of-contents__link toc-highlight">Unusual Executables or Processes (that launch on boot)</a></li><li><a href="#documentation" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></li><li><a href="#containment--mitigation-" class="table-of-contents__link toc-highlight">Containment / Mitigation <a name="con"></a></a><ul><li><a href="#reset-or-lock-compromised-accounts" class="table-of-contents__link toc-highlight">Reset or lock compromised accounts</a></li><li><a href="#secure-uninfected-systems" class="table-of-contents__link toc-highlight">Secure uninfected systems</a></li><li><a href="#encapsulation-of-infected-subnetssystems" class="table-of-contents__link toc-highlight">Encapsulation of infected subnets/systems</a></li><li><a href="#pausing-of-infected-or-potential-infected-vms" class="table-of-contents__link toc-highlight">Pausing of infected or potential infected VMs</a></li><li><a href="#shutdown-of-infected-or-potential-infected-systems-non-vm" class="table-of-contents__link toc-highlight">Shutdown of infected or potential infected Systems (Non-VM)</a></li><li><a href="#disconnect-shared-drives" class="table-of-contents__link toc-highlight">Disconnect shared drives</a></li><li><a href="#restrict-or-disable-internet-connection-for-infected-segments" class="table-of-contents__link toc-highlight">Restrict or disable internet connection for infected segments</a></li><li><a href="#check-back-up-availability" class="table-of-contents__link toc-highlight">Check Back-Up availability</a></li><li><a href="#secure-needed-data" class="table-of-contents__link toc-highlight">Secure needed data</a></li><li><a href="#communication-internal-and-external" class="table-of-contents__link toc-highlight">Communication internal and external</a></li><li><a href="#documentation-1" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></li><li><a href="#analysis-" class="table-of-contents__link toc-highlight">Analysis <a name="analysis"></a></a><ul><li><a href="#determine-the-ransomwaremalware-type" class="table-of-contents__link toc-highlight">Determine the Ransomware/Malware type</a></li><li><a href="#determine-the-attack-vector" class="table-of-contents__link toc-highlight">Determine the attack vector</a></li><li><a href="#gather-information-about-the-malware-that-was-deployed-and-their-damage-potential" class="table-of-contents__link toc-highlight">Gather information about the malware that was deployed and their damage potential</a></li><li><a href="#determine-the-scope-of-the-attack" class="table-of-contents__link toc-highlight">Determine the scope of the attack</a></li><li><a href="#timeline" class="table-of-contents__link toc-highlight">Timeline</a></li><li><a href="#check-for-backdoors" class="table-of-contents__link toc-highlight">Check for backdoors</a></li><li><a href="#documentation-2" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></li><li><a href="#remediation-" class="table-of-contents__link toc-highlight">Remediation <a name="rem"></a></a><ul><li><a href="#close-the-attack-vector" class="table-of-contents__link toc-highlight">Close the attack vector</a></li><li><a href="#patching" class="table-of-contents__link toc-highlight">Patching</a></li><li><a href="#ioc-search-the-whole-infrastructure" class="table-of-contents__link toc-highlight">IoC search the whole infrastructure</a></li><li><a href="#remove-backdoors-and-other-malware-from-the-systems" class="table-of-contents__link toc-highlight">Remove backdoors and other malware from the systems</a></li><li><a href="#adjust-firewall--ids--av" class="table-of-contents__link toc-highlight">Adjust Firewall / IDS / AV</a></li><li><a href="#documentation-3" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></li><li><a href="#recovery-" class="table-of-contents__link toc-highlight">Recovery <a name="rec"></a></a><ul><li><a href="#rebuild-or-cleanse-infected-systems-in-a-new-network-zone" class="table-of-contents__link toc-highlight">Rebuild or cleanse infected systems in a new network zone</a></li><li><a href="#rebuild-the-domain" class="table-of-contents__link toc-highlight">Rebuild the domain</a></li><li><a href="#recover-data-from-known-good-backups" class="table-of-contents__link toc-highlight">Recover data from known good backups</a></li><li><a href="#pay-the-ransom-if-no-other-way-can-be-found" class="table-of-contents__link toc-highlight">Pay the ransom (if no other way can be found)</a></li><li><a href="#address-collateral-damage" class="table-of-contents__link toc-highlight">Address collateral damage</a></li><li><a href="#ensure-that-network-traffic-is-back-to-normal" class="table-of-contents__link toc-highlight">Ensure that network traffic is back to normal</a></li><li><a href="#documentation-4" class="table-of-contents__link toc-highlight">Documentation</a></li></ul></li><li><a href="#post-morten-" class="table-of-contents__link toc-highlight">Post Morten <a name="post"></a></a><ul><li><a href="#review-the-incident-response-process" class="table-of-contents__link toc-highlight">Review the incident response process</a></li><li><a href="#discuss-security-enhancements" class="table-of-contents__link toc-highlight">Discuss security enhancements</a></li><li><a href="#conduct-external-reviews" class="table-of-contents__link toc-highlight">Conduct external reviews</a></li><li><a href="#determine-incident-cost" class="table-of-contents__link toc-highlight">Determine Incident cost</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Wiki</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/wiki/gettingstarted">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/wiki/overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/wiki/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">Incident Response Playbooks</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/playbooks/gettingstarted">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/playbooks/ransomware">Ransomware</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/playbooks/bec">Business Mail Compromise</a></li></ul></div><div class="col footer__col"><div class="footer__title">Misc</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/contributors">Contributors</a></li><li class="footer__item"><a class="footer__link-item" href="/copyright">Copyright</a></li><li class="footer__item"><a class="footer__link-item" href="/impress">Impress</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Explie/DFIR-playbooks-and-wiki" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 IT-Forensics Wiki built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.c7c6c551.js"></script>
<script src="/assets/js/main.befeee4c.js"></script>
</body>
</html>